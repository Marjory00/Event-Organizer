<h2>Budget Planner</h2>

<div class="budget-form">
  <h3>Add a New Budget Item</h3>
  <form (ngSubmit)="addBudgetItem()" #budgetForm="ngForm">
    <div class="form-group">
      <label for="item-name">Item Name:</label>
      <input
        id="item-name"
        type="text"
        [(ngModel)]="newBudgetItem.name"
        name="name"
        required
        #itemName="ngModel">
      <div *ngIf="itemName.invalid && (itemName.dirty || itemName.touched)" class="error-message">
        Item name is required.
      </div>
    </div>
    <div class="form-group">
      <label for="item-cost">Cost ($):</label>
      <input
        id="item-cost"
        type="number"
        [(ngModel)]="newBudgetItem.cost"
        name="cost"
        required
        #itemCost="ngModel">
      <div *ngIf="itemCost.invalid && (itemCost.dirty || itemCost.touched)" class="error-message">
        Cost is required.
      </div>
    </div>
    <button type="submit" [disabled]="budgetForm.invalid">Add Item</button>
  </form>
</div>

<hr>

<div class="budget-summary">
  <h3>Total Budget: ${{ totalCost$ | async | number:'1.2-2' }}</h3>
  <p>Total Items: {{ itemCount$ | async }}</p>
</div>

<h3>Budget Items</h3>
<table>
  <thead>
    <tr>
      <th>Item</th>
      <th>Cost</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let item of budgetItems$ | async">
      <ng-container *ngIf="!item.isEditing">
        <td>{{ item.name }}</td>
        <td>${{ item.cost | number:'1.2-2' }}</td>
        <td>
          <button (click)="editItem(item)">Edit</button>
          <button (click)="removeBudgetItem(item.id)">Remove</button>
        </td>
      </ng-container>
      <ng-container *ngIf="item.isEditing">
        <td>
          <input [(ngModel)]="item.name" name="name-{{item.id}}" required>
        </td>
        <td>
          <input type="number" [(ngModel)]="item.cost" name="cost-{{item.id}}" required>
        </td>
        <td>
          <button (click)="saveEdit(item)">Save</button>
          <button (click)="cancelEdit(item)">Cancel</button>
        </td>
      </ng-container>
    </tr>
  </tbody>
</table>
